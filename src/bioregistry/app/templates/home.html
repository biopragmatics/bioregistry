{% extends "base.html" %}

{% block title %}Bioregistry{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
    $(".basicAutoComplete").autoComplete({
        resolverSettings: {
            url: "{{ url_for('api.search') }}"
        }
    });
    </script>
{% endblock %}

{% block containerattr %}class="col-md-10 col-lg-10"{% endblock %}

{% block container %}
    <div class="card card-body bg-light">
        <h1 class="display-3">Bioregistry</h1>
        <p class="lead">
            The Bioregistry is an open source, community curated registry, meta-registry, and compact
            identifier resolver. Here's what that means:
        </p>
        <dl class="row">
            <dt class="col-lg-2 text-right text-nowrap">Registry</dt>
            <dd class="col-lg-10">
                A collection of metadata about ontologies, controlled vocabularies, and resources. Some other
                well-known registries are the <a href="http://www.obofoundry.org/">OBO Foundry</a>,
                <a href="https://identifiers.org">Identifiers.org</a>, and the
                the <a href="https://www.ebi.ac.uk/ols/index">OLS</a>.
            </dd>
            <dt class="col-lg-2 text-right text-nowrap">Metaregistry</dt>
            <dd class="col-lg-10">
                A collection of metadata about registries and mappings between the resources they describe. For
                example, <a href="https://www.ebi.ac.uk/chebi">ChEBI</a> appears in all of the example registries
                from above. So far, the Bioregistry is the <i>only</i> metaregistry.
            </dd>
            <dt class="col-lg-2 text-right text-nowrap">Resolver</dt>
            <dd class="col-lg-10">
                A tool for mapping compact identifiers of the form <code>prefix:identifier</code> to HTML and structured
                content providers. Some other well-known resolvers are
                <a href="https://identifiers.org">Identifiers.org</a> and <a href="https://n2t.net/">Name-To-Thing</a>.
            </dd>
            <dt class="col-lg-2 text-right text-nowrap">Open Source</dt>
            <dd class="col-lg-10">
                Anyone can suggest or make pull requests to update the underlying database, which is stored in
                <a href="https://github.com/bioregistry/bioregistry/blob/main/src/bioregistry/data/bioregistry.json">
                    JSON</a> on GitHub where the community can engage in an open review process.
            </dd>
        </dl>
        <p>Here's how to get started with the Bioregistry site:</p>
        <div class="list-group">
            <a href="{{ example_url }}" class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1"><i class="fas fa-share-square"></i> Resolve</h5>
                </div>
                <p class="mb-1">A compact identifier like <span class="badge badge-light">{{ example_url }}</span>.</p>
            </a>
            <a href="{{ url_for('ui.resources') }}"
               class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1"><i class="fas fa-list"></i> View Registry</h5>
                    <small class="text-muted">{{ registry_size }} entries</small>
                </div>
                <p class="mb-1">The integrative registry of biological databases, ontologies, and resources.</p>
            </a>
            <a href="{{ url_for('ui.metaresources') }}"
               class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1"><i class="fas fa-atom"></i> View Metaregistry</h5>
                    <small class="text-muted">{{ metaregistry_size }} registries</small>
                </div>
                <p class="mb-1">The registry of registries.</p>
            </a>
            <a href="{{ url_for('ui.collections') }}"
               class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1"><i class="fas fa-layer-group"></i> View Collections</h5>
                    <small class="text-muted">{{ collections_size }} collections</small>
                </div>
                <p class="mb-1">Manually curated subsets of the registry.</p>
            </a>
            <a href="{{ url_for('summary') }}"
               class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1"><i class="fas fa-book"></i> Learn</h5>
                </div>
                <p class="mb-1">About the motivation for constructing the Bioregistry and insights gathered from the
                    meta-registry.</p>
                {# <small class="text-muted">Donec id elit non mi porta.</small> #}
            </a>
            <a href="{{ url_for('download') }}"
               class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1"><i class="fas fa-download"></i> Download</h5>
                </div>
                <p class="mb-1">All of the data in the Bioregistry.</p>
                <small class="text-muted">Available under the CC0 1.0 Universal License.</small>
            </a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    {# This is a Vue template which also uses {{ value }} syntax, use raw to avoid mixups. #}
    {% raw %}
    <div id="vue-app">
      <div class="card-body">
        <h5 class="card-title">Prefix Search</h5>
        <div class="input-group mb-3">
          <input type="text"
                 v-model="content"
                 class="form-control"
                 @input="getPrefix"
                 placeholder="Search for a prefix"
                 aria-label="Search for a prefix"
                 aria-describedby="basic-addon2">
          <div class="input-group-append">
            <input class="btn btn-outline-secondary" type="submit" value="Search">
          </div>
        </div>
      </div>
      <div v-show="current_results" class="card-body">
        <h6 class="card-title">
          Completions for {{ content }}
        </h6>
        <div v-if="current_results && current_results.length">
          <div v-for="result in current_results">
            {{ result }}
          </div>
        </div>
        <div v-else>
          <i style="color: red;">No results.</i>
        </div>
      </div>
    </div>
    {% endraw %}

    <script>
      var app = new Vue({
        el: '#vue-app',
        data: {
          last_yielding_result: null,
          content: null,
          current_results: null,
          autocomplete_url: "{{ url_for('api.autocomplete') }}"
        },
        methods: {
          /// Get the data to suggest auto-completes to the prefix.
          getPrefix: async function(input_event) {
            // If we are adding more text to a result query that returns nothing, it will
            // continue to return nothing.
            if (input_event.inputType === "insertText"
                && this.content
                && this.current_results
                && !this.current_results.length) {
              return
            }

            // If the content has been emptied, clear out the display field.
            if (this.content === "") {
              this.current_results = null;
              return
            }

            // Get the suggestions from the server.
            console.log(`Getting autocomplete options for: "${this.content}".`);
            const resp = await fetch(`${this.autocomplete_url}?q=${this.content}`);
            if (resp.status !== 200) {
              console.log(`ERROR: ${resp.status}: ${resp.statusText}`);
            }
            const resp_json = await resp.json();
            console.log(resp_json);

            // Populate the results.
            this.current_results = resp_json.results;

            // If this result yielded something, remember it.
            if (this.current_results.length) {
              this.last_yielding_result = this.content;
            }
          }
        }
      })
    </script>
{% endblock %}

